<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CMMC Level 2 Practices — TANO Research</title>

  <link rel="stylesheet" href="../../styles.css" />

  <style>
    .card { overflow: visible !important; }
    .table-wrapper {
      max-height: 600px; overflow-y: auto; border: 1px solid #333;
      background: #111; border-radius: 6px; margin-top: 20px;
    }
    table { width: 100%; border-collapse: collapse; background: #1e1e1e; color: #fff; }
    th, td { padding: 10px; border: 1px solid #333; }
    th { background: #333; position: sticky; top: 0; }
    tr:nth-child(even) { background: #252525; }
    .search-box {
      width: 100%; padding: 10px; margin-top: 10px;
      background: #111; border: 1px solid #444; color: #fff;
    }
    .nav-row { margin: 1rem 0; }
  </style>
</head>

<body>

<div class="nav-row">
  <a href="../Overview.html" class="btn-primary">← Back to Playbook Overview</a>
  <a href="../../cmmc.html" class="btn-primary">← Return to CMMC Center</a>
  <a href="../../index.html" class="btn-primary">← Back to TANO Home</a>
</div>

<div class="card">

  <h1>CMMC Level 2 Practices</h1>
  <p><b>TANO — Trust • Accuracy • Neutrality • Organization • Transparency</b></p>
  <p>This table loads directly from <code>L2_Practices.csv</code>.</p>

  <input id="searchInput" class="search-box" placeholder="Search (e.g. AC.L2, MFA, audit)" onkeyup="filterTable()" />

  <div id="status" class="loading">Loading Level 2 practices…</div>

  <div class="table-wrapper">
    <table id="l2Table">
      <thead>
        <tr>
          <th>Practice ID</th>
          <th>Domain</th>
          <th>Practice Name</th>
          <th>Description</th>
          <th>Source</th>
        </tr>
      </thead>
      <tbody id="l2Body"></tbody>
    </table>
  </div>

</div>

<script>
function parseCSV(text) {
  const rows = [];
  const lines = text.split(/\r?\n/).filter(line => line.trim() !== "");

  for (const line of lines) {
    let cells = [];
    let cur = "";
    let q = false;

    for (let i = 0; i < line.length; i++) {
      const c = line[i];

      if (c === '"') { q = !q; continue; }
      if (c === ',' && !q) { cells.push(cur); cur = ""; continue; }

      cur += c;
    }

    cells.push(cur);
    rows.push(cells);
  }

  return rows;
}

function buildTable(rows) {
  const header = rows[0];

  const idxId   = header.indexOf("Practice ID");
  const idxDom  = header.indexOf("Domain");
  const idxName = header.indexOf("Practice Name");
  const idxDesc = header.indexOf("Description");
  const idxSrc  = header.indexOf("Source");

  const tbody = document.getElementById("l2Body");

  for (let i = 1; i < rows.length; i++) {
    const r = rows[i];
    if (!r[idxId]) continue;

    const tr = document.createElement("tr");

    tr.innerHTML = `
      <td>${r[idxId]}</td>
      <td>${r[idxDom]}</td>
      <td>${r[idxName]}</td>
      <td>${r[idxDesc]}</td>
      <td>${r[idxSrc]}</td>
    `;
    tbody.appendChild(tr);
  }

  document.getElementById("status").style.display = "none";
}

function filterTable() {
  const f = document.getElementById("searchInput").value.toLowerCase();
  const rows = document.querySelectorAll("#l2Body tr");
  rows.forEach(row => row.style.display = row.textContent.toLowerCase().includes(f) ? "" : "none");
}

fetch("https://ochoa104cy.github.io/TANO-Research/cmmc-playbook/controls/L2_Practices.csv")
  .then(r => r.text())
  .then(t => buildTable(parseCSV(t)))
  .catch(e => document.getElementById("status").textContent = "Failed to load L2 CSV");
</script>

</body>
</html>
