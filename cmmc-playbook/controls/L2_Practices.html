<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>CMMC Level 2 Practices — TANO Research</title>
  <link rel="stylesheet" href="../../styles.css" />

  <style>
    .card { overflow: visible !important; }
    .table-wrapper {
      max-height: 600px; overflow-y: auto; overflow-x: auto;
      background: #111; border: 1px solid #333; border-radius: 6px;
      margin-top: 20px;
    }
    table { width: 100%; border-collapse: collapse; color: white; }
    th, td { border: 1px solid #333; padding: 10px; }
    th { background:#333; position: sticky; top:0; }
    tr:nth-child(even) { background:#252525; }
    .search-box {
      width: 100%; padding:10px; background:#111;
      border:1px solid #444; color:white; margin-top:10px;
    }
  </style>
</head>

<body>

<div style="margin:1rem 0;">
  <a href="../Overview.html" class="btn-primary">← Return to Playbook Overview</a> |
  <a href="../../cmmc.html" class="btn-primary">← Return to CMMC Center</a> |
  <a href="../../index.html" class="btn-primary">← Back to TANO Home</a>
</div>

<div class="card">
  <h1>CMMC Level 2 Practices</h1>
  <p><strong>TANO = Trust • Accuracy • Neutrality • Organization • Transparency</strong></p>
  <p>This table loads directly from <code>L2_Practices.csv</code>.</p>

  <input id="searchInput" class="search-box" onkeyup="filterTable()" placeholder="Search… (e.g., 3.1.1, MFA, encryption)">

  <div id="status">Loading Level 2 practices…</div>

  <div class="table-wrapper">
    <table>
      <thead>
        <tr>
          <th>Practice ID</th>
          <th>Domain</th>
          <th>NIST Ref</th>
          <th>Practice Name</th>
          <th>Description</th>
        </tr>
      </thead>
      <tbody id="l2Body"></tbody>
    </table>
  </div>
</div>

<footer>© TANO Research — Exploring Possibilities with Integrity Everywhere</footer>

<script>
const CSV_URL =
  "https://ochoaeg.github.io/TANO-RESEARCH.GITHUB.IO/cmmc-playbook/controls/L2_Practices.csv";

function parseCSV(text) {
  const lines = text.split(/\r?\n/).filter(x => x.trim() !== "");
  return lines.map(line => {
    let cells = [], cur = "", quote = false;
    for (let c of line) {
      if (c === '"') quote = !quote;
      else if (c === "," && !quote) { cells.push(cur); cur = ""; }
      else cur += c;
    }
    cells.push(cur);
    return cells;
  });
}

function buildTable(rows) {
  const tbody = document.getElementById("l2Body");
  const header = rows[0];

  const id = header.indexOf("Practice_ID");
  const dom = header.indexOf("Domain");
  const ref = header.indexOf("NIST_Ref");
  const name = header.indexOf("Practice_Name");
  const desc = header.indexOf("Practice_Description");

  for (let i = 1; i < rows.length; i++) {
    const r = rows[i];
    if (!r[id]) continue;
    tbody.innerHTML += `
      <tr>
        <td>${r[id]}</td>
        <td>${r[dom]}</td>
        <td>${r[ref]}</td>
        <td>${r[name]}</td>
        <td>${r[desc]}</td>
      </tr>`;
  }

  document.getElementById("status").style.display = "none";
}

function filterTable() {
  const f = document.getElementById("searchInput").value.toLowerCase();
  document.querySelectorAll("#l2Body tr").forEach(tr => {
    tr.style.display = tr.textContent.toLowerCase().includes(f) ? "" : "none";
  });
}

fetch(CSV_URL)
  .then(r => { if (!r.ok) throw new Error("CSV not found"); return r.text(); })
  .then(text => buildTable(parseCSV(text)))
  .catch(err => {
    document.getElementById("status").textContent = "Error: " + err.message;
  });
</script>

</body>
</html>
